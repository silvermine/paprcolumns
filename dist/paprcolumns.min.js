!function(a,b){function c(a){window.console&&window.console.log&&window.console.log(a)}function d(a){return e(a,"maxTextIterations"),e(a,"minTextIncrement"),a.mode.validateSettings(a),a}function e(b,c){var d=b[c],e=parseInt(d,10);b[c]=isNaN(e)||0>=e?a.paprcolumns.defaults[c]:e}function f(b,c){var d=b[c],e=parseFloat(d);b[c]=isNaN(e)||0>e||e>1?a.paprcolumns.defaults[c]:e}function g(a,b){this.$elem=a,this.settings=b}function h(a,b){g.call(this,a,b)}function i(a,b){g.call(this,a,b)}g.prototype.run=function(){return this.$elem.data("PaprColumnizer.COLUMNIZING")?(c("Columnizing is already happening"),void 0):(c("starting columnization"),this.$elem.data("PaprColumnizer.COLUMNIZING",!0),this.prepareForColumnization(),this.columnize(),this.addFirstLastColClasses(),this.afterColumnization(),this.$elem.data("PaprColumnizer.COLUMNIZING",!1),this.bindEventHandlers(),c("columnization done"),void 0)},g.prototype.bindEventHandlers=function(){if(!this.eventHandlersBound){this.eventHandlersBound=!0;var b=this;a(window).resize(function(){b.onWindowResize()}),a(window).load(function(){b.$dest.find("img").each(function(c,d){var e=a(d),f=b.$contents.find("img#"+e.attr("id"));f.height(e.height()).width(e.width())}),c("recolumnizing because window has finished loading"),b.run()})}},g.prototype.addFirstLastColClasses=function(){this.$holder.find(".col").last().addClass("lastcol").end().first().addClass("firstcol")},g.prototype.prepareForColumnization=function(){this.$contents||(this.$contents=this.$elem.contents().clone(!0),this.$contents.find("img").each(function(b,c){var d=a(c);d.addClass("dontsplit"),""===a.trim(d.attr("id"))&&d.attr("id","img-"+b)})),this.$elem.empty(),this.$dest=this.$elem.addClass("columnized"),this.$holder=a("<div />").addClass("colHolder").appendTo(this.$dest)},g.prototype.prepareSplitElement=function(c,d){if(c.addClass("split"),d.addClass("split"),c.attr("id")!==b&&""!==a.trim(c.attr("id"))){var e=c.attr("id"),f=e+"-splitID";c.removeAttr("id").addClass(f).data("undosplit",function(){this.attr("id",e).removeClass(f).removeClass("split")})}else c.data("undosplit",function(){this.removeClass("split")})},g.prototype.onWindowResize=function(){this.equalizeColumnHeights()},g.prototype.afterColumnization=function(){this.$holder.find(".col").css("height",""),this.equalizeColumnHeights()},g.prototype.equalizeColumnHeights=function(){var b=this.$holder.find(".col"),d=Math.max.apply(null,a.makeArray(b.map(function(){return a(this).height()})));b.height(d),c("set all columns to max height: "+d)},g.prototype.createColumn=function(b){return a("<div />").attr("id","col-"+b).addClass("col")},g.prototype.splitInto=function(b,c,d){var e=this,f=0,g=!1;return b.each(function(b,h){var i=a(h);if(i.detach().appendTo(c),f=b,!d()){if(i.detach(),i.hasClass("dontsplit"))return f--,!1;if(i.get(0).nodeType===j.TEXT){var k=a('<span class="splitTextNode" />').appendTo(c),l=e.splitTextInto(i.text(),k,d);if(l===!1)return k.remove(),f--,!1;i.text(""),g=a('<span class="splitTextNode" />').text(l)}else{var m=i.clone(!0),n=m.contents();m.empty().appendTo(c),e.prepareSplitElement(i,m),g=i.empty().append(e.splitInto(n,m,d)),e.isEmptyOrEmptyTextNode(m.contents())&&(m.remove(),i.data("undosplit").call(i)),i.removeData("undosplit")}return!1}}),a("<div />").append(g).append(b.slice(f+1)).contents()},g.prototype.splitTextInto=function(b,c,d){var e=this.findBestSplitLocation(b,c,d),f=e===!1?!1:b.substr(0,e);return f===!1||""===a.trim(f)?!1:(c.text(b.substr(0,e)),b.substr(e))},g.prototype.findBestSplitLocation=function(a,b,c){for(var d={min:0,max:a.length},e=Math.floor(a.length/2),f=!1,g=0;g<this.settings.maxTextIterations;g++){var h=this.findWordBreakNear(a,e);if(b.text(a.substr(0,h)),c()?f=d.min=h:d.max=h,e=d.max-Math.floor((d.max-d.min)/2),d.max-d.min<this.settings.minTextIncrement)break}return f},g.prototype.findWordBreakNear=function(a,b){return a.indexOf(" ",b)},g.prototype.isEmptyOrEmptyTextNode=function(b){return 0===b.size()||1===b.size()&&b.get(0).nodeType===j.TEXT&&""===a.trim(a(b.get(0)).text())},h.validateSettings=function(a){e(a,"columns"),e(a,"maxIterations"),e(a,"targetHeightMaxOver"),f(a,"targetHeightFuzz")},h.prototype=new g,h.prototype.constructor=h,h.prototype.calculateHeight=function(){this.$holder.empty();for(var a=0;a<this.settings.columns;a++)this.createColumn(a).appendTo(this.$holder);var b=this.$holder.find(".col").first().append(this.$contents.clone(!0)).height(),d=parseInt(b/this.settings.columns,10),e=this.padHeight(d);return c("elem height: "+b+"; target height now: "+e),this.$holder.empty(),e},h.prototype.padHeight=function(a){return parseInt(Math.min(a+this.settings.targetHeightMaxOver,a*(1+this.settings.targetHeightFuzz)),10)},h.prototype.columnize=function(){this.$dest.addClass("fixedNumCols").addClass("columns-"+this.settings.columns),this.columnizeToTargetHeight(this.calculateHeight(),1)},h.prototype.columnizeToTargetHeight=function(a,b){c("fixed number columns: "+this.settings.columns+"; to target height: "+a+"; iteration: "+b);for(var d=this.$contents.clone(!0),e=function(){return g.outerHeight(!0)<=a},f=0;f<this.settings.columns;f++){var g=this.createColumn(f).appendTo(this.$holder);d=this.splitInto(d,g,e)}return d.size()>0?(c("contents are left over: "+d.size()),b>=this.settings.maxIterations?(this.$holder.find(".col").last().append(d),c("added all remaining contents to the last column because we are over max iterations"),void 0):(this.$holder.empty(),this.columnizeToTargetHeight(this.padHeight(a),b+1))):void 0},i.validateSettings=function(a){e(a,"columnHeight")},i.prototype=new g,i.prototype.constructor=i,i.prototype.onWindowResize=function(){},i.prototype.equalizeColumnHeights=function(){this.$holder.find(".col").height(this.settings.columnHeight)},i.prototype.afterColumnization=function(){var b=this.$holder.find(".col"),c=0;this.equalizeColumnHeights(),b.each(function(b,d){c+=a(d).outerWidth(!0)}),this.$holder.width(c)},i.prototype.columnize=function(){this.$dest.addClass("fixedHeightCols"),c("fixed height columns: "+this.settings.columnHeight);for(var a=this.$contents.clone(!0),b=this.settings.columnHeight,d=0,e=function(){return f.outerHeight(!0)<=b};;){var f=this.createColumn(d++).appendTo(this.$holder);if(a=this.splitInto(a,f,e),0===a.size())break}},a.fn.paprcolumns=function(b){return this.each(function(){var d=a(this);c("paprcolumns on: "+d.prop("tagName"));var e=a.paprcolumns(b),f=new e.mode(d,e);d.data("paprcolumns",f),f.run()}),this},a.paprcolumns=function(b){var c=a.extend(!0,{},a.paprcolumns.defaults,b);return c=d(c)},a.paprcolumns.modes={FIXED_NUMBER:h,FIXED_HEIGHT:i},a.paprcolumns.defaults={mode:a.paprcolumns.modes.FIXED_NUMBER,maxTextIterations:20,minTextIncrement:10,columns:2,maxIterations:20,targetHeightMaxOver:50,targetHeightFuzz:.1,columnHeight:500};var j={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12}}(jQuery);